@using Blazor.Heroicons
@using Blazor.Heroicons.Outline

@inherits LayoutComponentBase
@inject AppBarTitleService TitleService

<div class="relative h-screen w-screen overflow-hidden">

    <!-- Drawer -->
    <aside class="@($"absolute left-0 top-0 bg-slate-200 shadow-lg w-64 h-full transform transition-transform duration-300 ease-in-out {(_drawerOpen ? "translate-x-0" : "-translate-x-full")}")">
        <nav class="flex flex-col h-full p-4">
            <ul class="space-y-2">
                <li><a href="#" class="block px-2 py-1 rounded hover:bg-slate-200">Home</a></li>
                <li><a href="#" class="block px-2 py-1 rounded hover:bg-slate-200">Calendar</a></li>
                <li><a href="#" class="block px-2 py-1 rounded hover:bg-slate-200">Settings</a></li>
            </ul>
        </nav>
    </aside>

    <div class="h-full flex flex-col transition-all duration-300 ease-in-out @(_drawerOpen ? "ml-64" : "ml-0")">
        <header class="relative flex items-center bg-slate-500 text-white p-4 shadow-md">
            <button @onclick="DrawerToggle" class="absolute left-4">
                <Heroicon Name="@HeroiconName.Bars3"
                          Type="HeroiconType.Outline"
                          class="h-6 w-6" />
            </button>
            <h1 class="flex-1 text-center text-4xl font-semibold">@appBarTitle</h1>
        </header>

        <main class="flex-1 overflow-auto">
            @Body
        </main>
    </div>
</div>

@code {
    private bool _drawerOpen = false;
    private string appBarTitle = string.Empty;

    protected override Task OnInitializedAsync()
    {
        appBarTitle = TitleService.Title;
        TitleService.OnTitleChanged += OnTitleChanged;
        return base.OnInitializedAsync();
    }

    private void OnTitleChanged(string newTitle)
    {
        appBarTitle = newTitle;
        InvokeAsync(StateHasChanged);
    }

    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }

    public void Dispose()
    {
        TitleService.OnTitleChanged -= OnTitleChanged;
    }
}
